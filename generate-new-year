#!/bin/sh
set -eu

# Move to the repo that this script resides in
cd "$(dirname "$0")"
pwd

# Generate and extract metadata needed
year="$(date +"%Y")"
uuid="$(julia -e "using UUIDs; print(UUIDs.uuid4())")"
name="$(git config user.name)"
email="$(git config user.email)"

# Use metadata to generate customized project files
sed -e "s/<year>/$year/g" \
    -e "s/<uuid>/$uuid/g" \
    -e "s/<name>/$name/g" \
    -e "s/<email>/$email/g" \
    Project.toml > Project.toml.tmp

mv Project.toml.tmp Project.toml

sed -e "s/<year>/$year/g" \
    "src/AdventOfCode<year>.jl" > "src/AdventOfCode$year.jl"

git rm "src/AdventOfCode<year>.jl"
